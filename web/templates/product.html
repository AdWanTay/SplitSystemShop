<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>{{.info.Title}} | ClimateHome - Продаем и устанавливаем сплит-системы в Уфе</title>


    <link rel="apple-touch-icon" sizes="180x180" href="/web/static/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/web/static/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/web/static/favicon/favicon-16x16.png">
    <link rel="manifest" href="/web/static/favicon/site.webmanifest">

    <link rel="stylesheet" href="/web/static/css/main.css"/>
    <link rel="stylesheet" href="/web/static/css/elements.css"/>
    <link rel="stylesheet" href="/web/static/css/product.css"/>

    <link rel="stylesheet" href="/web/static/notify/simple-notify.css"/>

    <script src="https://static.elfsight.com/platform/platform.js" async></script>
    <div class="elfsight-app-e4363121-2d4f-4914-8220-73508a36cd9e" data-elfsight-app-lazy></div>
</head>
<body>
{{template "header" .}}

<main class="main">
    <!-- Контейнер карточки -->
    <section class="product-page">
        <h1 class="product-title">{{.info.Title}}</h1>

        <div class="product-main">
            <div class="product-image">
                <img src="/web/static/img/primer.webp" alt="Название товара">
            </div>

            <div class="product-info">
                <p class="product-short">{{.info.ShortDescription}}</p>

                <div class="product-meta">
                    <span class="product-rating">Рейтинг: <strong>{{.info.AverageRating}}</strong></span>
                    <span class="product-category">{{ .info.Type.Name }}</span>
                    <span class="product-category">до {{ .info.RecommendedArea }} дБ</span>
                </div>

                <div class="product-price-block">
                    <div class="p-price">{{formatPrice .info.Price}} руб.</div>
                    <div class="product-actions">
                        <button class="btn-huge accent-btn">Заказать</button>
                        {{ if .isAuthenticated }}
                        {{ if .info.InFavorites }}
                        <button class="btn-huge primary-btn" onclick="">
                            <div class="p-f">
                                <span style="scale: 1.5">♥</span>В избранном</div>
                        </button>
                        {{else}}
                        <button class="btn-huge primary-btn" onclick="addToFavorites(this, {{.info.ID}})">
                            <div class="p-f">
                                <span style="scale: 1.5">♡</span>В избранное
                            </div>
                        </button>
                        {{end}}

                        {{else}}
                        <button class="btn-huge primary-btn" onclick="openAuthModal()">
                            <div class="p-f">
                                <span style="scale: 1.5">♡</span>В избранное
                            </div>
                        </button>
                        {{end}}
                    </div>
                </div>

                <div class="product-quick-specs">
                    <div class="spec-row">
                        <span class="spec-label">Модель</span>
                        <span class="spec-value">Coolray</span>
                    </div>
                    <div class="spec-row">
                        <span class="spec-label">Материал изделия</span>
                        <span class="spec-value">стекло</span>
                    </div>
                    <div class="spec-row">
                        <span class="spec-label">Марка автомобиля</span>
                        <span class="spec-value">Geely; Geely Coolray 2024</span>
                    </div>
                    <div class="spec-row">
                        <span class="spec-label">Комплектация</span>
                        <span class="spec-value">стекло на панель водителя; стекло на мультимедиа</span>
                    </div>

                    <button class="specs-btn btn-small primary-btn"
                            onclick="document.getElementById('desc').scrollIntoView({ behavior: 'smooth' });">
                        Характеристики и описание →
                    </button>
                </div>


            </div>
        </div>

        <div id="desc" class="product-desc">
            <h2>Описание и характеристики</h2>

            <details class="product-description" open>
                <summary>Описание</summary>

                <p>{{.info.LongDescription}}</p>
                <!--                <p><span>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Ab, cum doloribus earum est id illo ipsum labore minus numquam perspiciatis placeat quidem quisquam quod repellendus rerum sed tenetur totam voluptas?</span><span>Ab consectetur cum dignissimos dolor eius error est eveniet fugit id ipsum minima, modi nam nemo neque nesciunt nisi perferendis quis, quo reiciendis repellat sequi sint velit veniam vitae, voluptas!</span><span>Architecto cumque expedita natus nemo officia optio quam quo saepe unde voluptatem? Ab asperiores delectus deserunt dolores exercitationem impedit, laborum molestiae nam nesciunt numquam odio perspiciatis quibusdam quos soluta tenetur!</span><span>Deserunt eum hic odit pariatur suscipit. A autem deserunt dignissimos esse expedita facilis hic, minima molestias nemo numquam perspiciatis quasi quia quisquam rem sapiente, totam unde. Deserunt maiores saepe ullam.</span><span>Autem consequatur deleniti deserunt dicta dolor, dolorem error est nostrum nulla odit officiis quisquam quos sed sint velit. At nemo quas quis sed voluptas? Dolor dolorem eum ex illum natus.</span><span>Ab ad atque cum distinctio eveniet fugiat maxime nostrum, obcaecati pariatur possimus, quaerat, quos repellat reprehenderit sapiente tenetur. Animi aperiam aut earum magnam maxime neque obcaecati omnis quo reiciendis soluta.</span><span>Aliquam commodi ea id iure modi nemo, optio! Ad cum cumque deleniti deserunt dicta error vitae! Blanditiis consectetur delectus dignissimos eaque expedita, fuga fugit natus nihil pariatur ratione soluta, suscipit!</span><span>Aliquam asperiores commodi debitis dicta distinctio dolor dolores dolorum enim exercitationem facere fugiat fugit, hic illo iusto non obcaecati possimus quas quidem quis quod quos sed soluta veniam voluptas voluptatum.</span><span>Adipisci alias animi asperiores atque beatae cum cumque doloribus eveniet harum illum ipsam iure maxime nam numquam officia, quis quisquam quo quos ratione recusandae sunt ut veritatis vitae voluptate voluptatum.</span><span>Aperiam aut beatae blanditiis culpa delectus deserunt dignissimos earum eius, eligendi facere illo magni maxime nesciunt nisi nobis nulla optio, quam quas quidem quod reprehenderit rerum voluptate. Enim, facilis, obcaecati?</span></p>-->
            </details>

            <!-- Характеристики -->
            <details class="product-details" open>
                <summary>Характеристики</summary>

                <div class="spec-section">
                    <h3>Заводские данные</h3>
                    <div class="spec-grid">
                        <div class="spec-row"><span>Гарантия производителя:</span><span>36 мес.</span></div>
                        <div class="spec-row"><span>Страна производства:</span><span>Китай</span></div>
                    </div>
                </div>

                <div class="spec-section">
                    <h3>Общие параметры</h3>
                    <div class="spec-grid">
                        <div class="spec-row"><span>Тип кондиционера:</span><span>{{.info.Type.Name}}</span></div>
                        <div class="spec-row"><span>Тип системы:</span><span>Сплит-система</span></div>
                        <div class="spec-row"><span>Модель:</span><span>DEXP AC-CD7ONF</span></div>
                        <div class="spec-row"><span>Цвет:</span><span>Белый</span></div>
                    </div>
                </div>

                <div class="spec-section">
                    <h3>Конструкция</h3>
                    <div class="spec-grid">
                        <div class="spec-row">
                            <span>Инвертор:</span><span>{{if .info.HasInverter}}Да{{else}}Нет{{end}}</span></div>
                    </div>
                </div>

                <div class="spec-section">
                    <h3>Габариты и вес внутреннего блока</h3>
                    <div class="spec-grid">
                        <div class="spec-row">
                            <span>Глубина внутреннего блока:</span><span>{{.info.InternalDepth}} мм</span>
                        </div>
                        <div class="spec-row">
                            <span>Ширина внутреннего блока:</span><span>{{.info.InternalWidth}} мм</span>
                        </div>
                        <div class="spec-row">
                            <span>Высота внутреннего блока:</span><span>{{.info.InternalHeight}} мм</span>
                        </div>
                        <div class="spec-row">
                            <span>Вес внутреннего блока:</span><span>{{.info.InternalWeight}} кг</span>
                        </div>
                    </div>
                </div>

                <div class="spec-section">
                    <h3>Габариты и вес внешнего блока</h3>
                    <div class="spec-grid">
                        <div class="spec-row">
                            <span>Глубина внешнего блока (мм):</span><span>{{.info.ExternalDepth}} мм</span>
                        </div>
                        <div class="spec-row">
                            <span>Ширина внешнего блока (мм):</span><span>{{.info.ExternalWidth}} мм</span>
                        </div>
                        <div class="spec-row">
                            <span>Высота внешнего блока (мм):</span><span>{{.info.ExternalHeight}} мм</span>
                        </div>
                        <div class="spec-row">
                            <span>Вес внешнего блока (кг):</span><span>{{.info.ExternalWeight}} кг</span>
                        </div>
                    </div>
                </div>

            </details>
        </div>

        <div class="reviews-block">
            <h2>Отзывы</h2>

            {{ range .info.Reviews }}
            <div class="review-card">
                <div class="review-header">
                    <span class="review-author">{{.User.FirstName}}</span>
                    <div class="review-rating">
                        <span class="stars">{{ stars .Rating }}</span>
                        <span class="score">Оценка: {{.Rating}} / 5</span>
                    </div>
                </div>
                <p class="review-text">{{.Comment}}</p>
            </div>
            {{end}}
            {{if .isAuthenticated}}
            <button class="btn-standard accent-btn">Написать отзыв</button>
            {{else}}
            <button class="btn-standard accent-btn">Надо зарегаться</button>
            {{end}}
        </div>
    </section>

    {{template "popular-products" .}}

    {{template "contact-form" .}}

</main>

{{template "footer" .}}}

<script src="/web/static/notify/simple-notify.min.js"></script>
<script src="/web/static/js/utils.js"></script>
<script src="/web/static/js/app.js"></script>
<script>
    function addToFavorites(button, id) {
        fetch("/api/favorites", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({split_system_id: id})
        })
            .then(response => {
                if (!response.ok) throw new Error("Ошибка при добавлении в избранное");
                return response.json();
            })
            .then(data => {
                button.classList.add("active");
                button.setAttribute("onclick", ""); // убрать клик

                // Обновляем текст на "В избранном"
                button.innerHTML = `
                <div class="p-f">
                    <span style="scale: 1.5">♥</span>В избранном
                </div>
            `;

                showToast("", "Товар добавлен в избранное");
            })
            .catch(err => {
                alert("Ошибка: " + err.message);
            });
    }

</script>
</body>
</html>